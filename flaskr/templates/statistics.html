{% extends "layout.html" %} {% block content %}

<div class="container-statistics">
  <h1 class="mb-4">Statistics</h1>

  <!-- Taxa de acertos do usuário -->
  <section class="mb-5">
    <div class="card">
      <div class="card-header">
        <h5>Your Accuracy Rate</h5>
      </div>
      <div class="card-body text-center">
        <h2 class="display-4">{{ "%.1f"|format(accuracy_rate * 100) }}%</h2>
        <p class="text-muted">
          Hello, {{ user.name }}! This is your accuracy rate across all quizzes.
        </p>
      </div>
    </div>
  </section>

  <!-- Ranking geral -->
  <section class="mb-5">
    <div class="card">
      <div class="card-header">
        <h5>Ranking Geral</h5>
      </div>
      <div class="card-body">
        {% if ranking %}
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th>#</th>
              <th>Player</th>
              <th>Total Score</th>
              <th>Total Time</th>
            </tr>
          </thead>
          <tbody>
            {% for player in ranking %}
            <tr>
              <td>{{ loop.index }}</td>
              <td>{{ player.user_name }}</td>
              <td>
                {{ player.total_score }} / {{ player.total_max_possible_score }}
              </td>
              <td>{{ "%.1f"|format(player.total_time_taken) }}s</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
        <p class="text-muted">Nenhum resultado registrado ainda.</p>
        {% endif %}
      </div>
    </div>
  </section>

  <!-- Questões mais erradas e acertadas -->
  <section class="mb-5">
    <div class="row">
      <div class="col-md-6">
        <div class="card border-danger">
          <div class="card-header bg-danger text-white">
            <h5>Most Missed Question</h5>
          </div>
          <div class="card-body">
            {% if most_missed %}
            <p><strong>Question:</strong> {{ most_missed.proposition }}</p>
            <p><strong>Misses:</strong> {{ most_missed.miss_count }} times</p>
            {% else %}
            <p class="text-muted">No data available.</p>
            {% endif %}
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card border-success">
          <div class="card-header bg-success text-white">
            <h5>Most Correct Question</h5>
          </div>
          <div class="card-body">
            {% if most_correct %}
            <p><strong>Question:</strong> {{ most_correct.proposition }}</p>
            <p>
              <strong>Correct Answers:</strong> {{ most_correct.count_correct }}
              times
            </p>
            {% else %}
            <p class="text-muted">No data available.</p>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </section>

  <footer class="d-grid gap-2 d-md-flex justify-content-md-center mt-4 mb-4">
    <a class="btn btn-outline-info" href="{{ url_for('index') }}"
      >Back to Home</a
    >
  </footer>
</div>

{% endblock %}
